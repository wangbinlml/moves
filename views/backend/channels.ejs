<% include partials/header %>
<% include partials/sidebar %>
<link rel="stylesheet" href="/backend/vendor/css/demo/demo.css" type="text/css">
<link rel="stylesheet" href="/backend/vendor/css/metroStyle/metroStyle.css" type="text/css">

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            栏目
            <small>管理</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="/admin"><i class="fa fa-dashboard"></i>首页</a></li>
            <li class="active">栏目</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box" style="margin-bottom:auto">
                    <div class="box-header">
                        <h3 class="box-title">栏目列表</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div id="channels" class="zTreeDemoBackground left">
                            <ul id="treeChannels" class="ztree"></ul>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </section>
    <!-- /.content -->
</div>

<% include partials/footer %>
<script type="text/javascript" src="/backend/vendor/js/jquery.ztree.all.js"></script>
<script language="JavaScript">

    <!--
    var setting = {
        view: {
            addHoverDom: addHoverDom,
            removeHoverDom: removeHoverDom,
            selectedMulti: false
        },
        check: {
            enable: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        edit: {
            enable: true
        }
    };

    $(document).ready(function(){
        $.ajax({
            type: "get",
            url: "/admin/channels/load",
            asyc: false,
            data: {},
            error: function (error) {
                new Noty({
                    type: 'error',
                    layout: 'topCenter',
                    text: '内部错误，请稍后再试',
                    timeout: '5000'
                }).show();
            },
            success: function (result) {
                if (result.error) {
                    new Noty({
                        type: 'error',
                        layout: 'topCenter',
                        text: result.msg || '获取数据失败',
                        timeout: '2000'
                    }).show();
                } else {
                    zNodes = result.data;
                    $.fn.zTree.init($("#treeChannels"), setting, zNodes);
                }
            }
        });
    });

    var newCount = 1;
    function addHoverDom(treeId, treeNode) {
        var sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
        var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
            + "' title='add node' onfocus='this.blur();'></span>";
        sObj.after(addStr);
        var btn = $("#addBtn_"+treeNode.tId);
        if (btn) btn.bind("click", function(){
            var zTree = $.fn.zTree.getZTreeObj("treeChannels");
            zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
            return false;
        });
    };
    function removeHoverDom(treeId, treeNode) {
        $("#addBtn_"+treeNode.tId).unbind().remove();
    };
    //-->

</script>